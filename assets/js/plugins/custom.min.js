$(document).ready(function () {
    var table = $('#left-right-fix').DataTable({
        "language": {
            "info": "عرض _START_ إلى _END_ من _TOTAL_ مدخلات",
            "infoEmpty": "عرض 0 إلى 0 من 0 مدخلات",
            "lengthMenu": "عرض _MENU_ مدخلات",
            "search": "بحث:",
            "paginate": {
                "first": "الأول",
                "last": "الأخير",
                "next": "التالي",
                "previous": "السابق"
            }
        },
        scrollY: '55vh',
        autoWidth: true,
        scrollX: true,
        "searchable": false,
        scrollCollapse: false,
        paging: false,
        fixedColumns: {
            leftColumns: 0,
            rightColumns: 1
        },
        initComplete: function () {
            var api = this.api();

            // تأخير إعادة ضبط الأعمدة لحل مشكلة المحاذاة
            setTimeout(function () {
                api.columns.adjust();
            }, 200); // يمكن تجربة 200ms بدلاً من 500ms لتحسين الأداء

            // إضافة مربعات البحث إلى كل عمود
            api.columns().every(function () {
                let column = this;
                let title = column.footer() ? column.footer().textContent : '';

                let input = document.createElement('input');
                input.placeholder = title;

                if (column.footer()) {
                    column.footer().replaceChildren(input);
                }

                input.addEventListener('keyup', function () {
                    if (column.search() !== this.value) {
                        column.search(this.value).draw();
                    }
                });
            });
        }
    });

    // تفعيل التحرير المباشر باستخدام X-editable
    $('.editable').editable({
        url: '/update-data',
        mode: 'inline',
        emptytext: 'فارغ',
        params: function(params) {
            return params;
        },
        success: function(response, newValue) {
            console.log('Updated successfully:', newValue);
        },
        error: function(response, newValue) {
            console.error('Error updating:', response);
        }
    });

});

// التأكد من أن الجدول يعمل بشكل صحيح عند تغيير اتجاه الصفحة
layout_rtl_change('true');
